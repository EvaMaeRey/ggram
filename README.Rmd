---
output: 
  github_document:
    toc: TRUE
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  cache = F
)

options(digits = 3)

library(tidyverse)
```

# ggram

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
<!-- badges: end -->

`ggram` explores a method for creating a *quick* code-output side-by-side for sharing bite-sized how-tos.  The specific motivation is to easily feature ggplot2 extenders work - which so often *transform* user experience.

We're in the proof-of-concept phase (expect fragility), but the idea is: 

0) write some amazing plot code
1) copy the code you would like to quote
2) combine plot code (copied) and plot output w/ patchwork (code just an annotation).

Thanks to [ggplot2 extenders discussions](https://github.com/ggplot2-extenders/ggplot-extension-club/discussions/86) for ideas - there are more ideas there that deserve further exploration and may make the implementation better.

Install development version:

```{r, eval = F}
remotes::install_github("EvaMaeRey/ggram")
```

The following should be done in an interactive session:

```{r, eval = F}
library(ggram)

library(ggplot2)
#
ggplot(cars) + 
  aes(speed, dist) + 
  geom_point() + 
  geom_smooth() #<<

ggram("This is a ggram.") # this must be on a single line at this early development stage.
```



```{r eval = F, echo = F}
ggsave(filename = "man/figures/a_ggram0.png", width = 8, height = 5)
```


```{r read, echo = F}
knitr::include_graphics("man/figures/a_ggram0.png")
```



Notes:  ggram::ggram() fails given the string replacement in the current implementation...

```{r}
library(tidyverse)

```


# What's inside:

## `StatCode` & `StatCodeLineNumbers` parse code for disply on a ggplot

<details>


```{r StatCode}

# readLines(temp) |> flipbookr:::code_parse()

#' @importFrom dplyr mutate group_by filter row_number
#' @importFrom stringr str_remove str_split str_detect
#' @importFrom tidyr unnest

compute_panel_code <- function(data, scales){
  
 data |>
    mutate(row = row_number()) |> 
    mutate(is_highlighted = str_detect(.data$code, "#<<")) |> 
    mutate(code = str_remove(.data$code, "#<<")) |>
    mutate(code = str_remove(.data$code, "^#$")) |>
    mutate(code = str_split(.data$code, "")) |>
    unnest(code) |>
    group_by(row) |> 
    mutate(x = row_number()) |>
    mutate(is_character = .data$code != " ") |>
    mutate(is_code = cumsum(.data$is_character) |> as.logical()) |>
    filter(.data$is_code) |>
    mutate(label = .data$code)
  
}

compute_panel_code_line_numbers <- function(data, scales){
  
 data |>
    mutate(row = row_number()) 
  
}

#' @importFrom ggplot2 ggproto aes after_stat Stat
StatCode <- ggproto("StatCode", Stat,
                    compute_panel = compute_panel_code,
                    default_aes = aes(fill = after_stat(is_highlighted),
                                      y = after_stat(row))
                    )

#' @importFrom ggplot2 ggproto aes after_stat Stat
StatCodeLineNumbers <- ggproto("StatCodeLineNumbers", Stat,
                    compute_panel = compute_panel_code_line_numbers,
                    default_aes = aes(y = after_stat(row),
                                      x = after_stat(-0.5),
                                      hjust = after_stat(1),
                                      label = after_stat(row))
                    )
```

</details>

```{r create_plot_code}
# for demo purposes only
create_plot_code <- function(){
  
"library(ggplot2)

ggplot(cars) +
  aes(speed, dist) #<< + 
  geom_point()"

  }


code_to_vector <- function(code){
  
  if(code |> is.null()){NULL}else{str_split(code, "\\n")[[1]]}
  
}
```

```{r}
create_plot_code() |> 
  code_to_vector()
```


## `code_file_to_code_df` parses code or code file to a dataframe

```{r code_file_to_code_df}
code_file_to_code_df <- function(code = NULL, filepath = ".Rhistory"){
  
  code_vector <- code |> code_to_vector()
  code_vector <- code_vector %||% clipr::read_clip()
  
  code_vector |> 
    # styler::style_text() |> 
    as.character() |>
    data.frame(code = _) #|>
    # filter(!stringr::str_detect(code, "^ggram.+"))
  
}
```


```{r}
# ggram:::clearhistory()

ggplot(cars) + 
  aes(speed, dist) + 
  geom_point()

create_plot_code() |>
code_file_to_code_df() |> 
  compute_panel_code()


create_plot_code() |>
code_file_to_code_df() |>
  ggplot() + 
  aes(code = code) + 
  geom_text(stat = StatCode) + 
  geom_tile(stat = StatCode, alpha = .2) + 
  scale_y_reverse()

"library(ggplot2)

ggplot(cars) +
  aes(speed, dist) #<< + 
geom_point()" |>
code_file_to_code_df(code = _) |>
  ggplot() + 
  aes(code = code) + 
  geom_text(stat = StatCode) + 
  geom_tile(stat = StatCode, alpha = .2) + 
  scale_y_reverse()


```

## `stamp_notebook` contains instructions for stamping down a notebook paper look

Only one style currently is supported for the code visual.

```{r stamp_notebook}
stamp_punched_holes <- function(){
  
   list(
    annotate("point", x = -1.5, y = I(c(1,9,17)/20) , color = "white", size = 5) ,
    annotate("point", x = -1.5, y = I(c(1,9,17)/20), shape = 21, 
             alpha = .3, size = 5, fill = "grey92")
   )
  
}


stamp_notebook <- function(vline_color = "darkred", 
                           hline_color = "blue", 
                           paper_color = alpha("whitesmoke", .1),
                           width = 35,
                           height = 20, 
                           accent = stamp_punched_holes()){
  
  list(
    
    theme_void(),
    theme(plot.background = element_rect(fill = paper_color)),
    scale_y_reverse(limits = c(-1, height)),
    # coord_equal(),
    scale_x_continuous(limits = c(-3, width)),
    annotate("rect", xmin = -Inf, xmax = 0, ymin = -Inf, ymax = Inf, 
             fill = ggplot2::alpha("grey90", .1)),
    geom_vline(xintercept = 0, color = vline_color) ,
    geom_hline(yintercept = 1:29 + .5, color = hline_color, linewidth = .2, alpha = .5),
    accent
    
  )
  
}
```

```{r}
ggplot() + 
  stamp_notebook()
```

# Styling aspiration, not exported, for graph-side (right-hand-side) 

```{r}
stamp_graph_paper <- function(){
  
  list(
    
    theme_classic(),
    theme(plot.background = element_rect(fill = ggplot2::alpha("whitesmoke", .1))),
    annotate(geom = "segment", x = I(-3:23/20), xend = I(-3:23/20), y = I(-.2), yend = I(1.1), color = "blue", alpha = .15, linewidth = .2) ,
    annotate(geom = "segment", y = I(-3:23/20), yend = I(-3:23/20), x = I(-.2), xend = I(1.1),  color = "blue", alpha = .15,  linewidth = .2),
    NULL,  
    coord_cartesian(clip = "off")
  )
  
}

ggplot(cars) + 
  stamp_graph_paper() + 
  aes(speed,dist) + 
  geom_point()
```




```{r, eval = F}
library(ggram)
library(tidyverse)

library(ggplot2)

ggram:::clearhistory()

```


## `code_df_to_code_plot()` prepares df 

```{r specify_code_plot_style}
specify_code_plot_style <- function(
                            highlight_colors = c(ggplot2::alpha("grey90",.4), alpha("yellow", .4)),
                                 family = "mono",
                                 size = 1,
                                 vline_color = "darkred", 
                                 hline_color = "blue", 
                                 paper_color = ggplot2::alpha("whitesmoke", .1),
                                 width = 35,
                                 height = 20, 
                                 accent = stamp_punched_holes()){
  
  list(highlight_colors = highlight_colors, 
       family = family,size = size, 
       vline_color = vline_color,      
       hline_color = hline_color, 
       paper_color = paper_color, 
       width = width, 
       height = height, 
       accent = accent)

}


```



```{r code_df_to_code_plot}

code_df_to_code_plot <- function(code_df, style_specs = specify_code_plot_style()){
  
  stamp_style <- stamp_notebook(style_specs$vline_color, style_specs$hline_color, 
                                style_specs$paper_color, style_specs$width, 
                                style_specs$height, style_specs$accent)
  
  code_df |>
  ggplot() +
    aes(code = code) +
    geom_tile(stat = StatCode) + 
    scale_fill_manual(values = style_specs$highlight_colors, 
                      breaks = c(FALSE, TRUE), guide = "none") +
    geom_text(stat = StatCode, alpha = .7, family = style_specs$family) +
    geom_text(stat = StatCodeLineNumbers, family = style_specs$family) +
    theme(legend.position = "none") + 
    stamp_style
  
}
```


```{r}

```



```{r}
create_plot_code() |>
  code_file_to_code_df() |>
  code_df_to_code_plot()

"ggplot(cars) + 
  aes(x,y) "|>
  code_file_to_code_df(code = _) |>
  code_df_to_code_plot(style_specs = 
                         specify_code_plot_style(family = "sans",
                                                 paper_color = "green",
                                                 accent = NULL))
```



```{r}
code_plot_style_college_rule <- function(){

  new <- list(width = 40, height = 25)
  
  specify_code_plot_style() |> modifyList(new)
    
}



code_plot_style_typed <- function(){
  
  new <- list(vline_color = "darkolivegreen", 
               hline_color = ggplot2::alpha("lightgrey", .1), 
               paper_color = ggplot2::alpha("whitesmoke", .1),
               width = 50,
               height = 30,
               accent = NULL)
  
  specify_code_plot_style() |> modifyList(new)

}



code_plot_style_cornsilk <- function(){
  
  new <- list(vline_color = ggplot2::alpha("cornsilk2",0), 
               hline_color = ggplot2::alpha("cornsilk2",0), 
               paper_color = ggplot2::alpha("cornsilk2",1),
               width = 50,
               height = 30,
               accent = NULL)

  specify_code_plot_style() |> modifyList(new)

  
}





stamp_buttons_and_bar <- function(){

  list(
  annotate("rect", xmin = -Inf, xmax = Inf, ymin = .96 |> I(), ymax = -Inf, fill = "black"),
     annotate("point", x = I(c(.025,.05, .075)), color = c("tomato", "goldenrod1", "green3"),
              y = I(.98))
  )
  
}


code_plot_style_dark_mode <- function(){
  
  new <- list(vline_color = ggplot2::alpha("grey30",0), 
               hline_color = ggplot2::alpha("grey30",0), 
               paper_color = ggplot2::alpha("grey30",1),
               width = 50,
               height = 30,
               accent = stamp_buttons_and_bar()
              )

    specify_code_plot_style() |> 
      modifyList(list(accent = NULL), keep.null = T) |> 
      modifyList(new, keep.null = T)

}

code_plot_style_dark_mode()


# geom_vline(xintercept = -.2, color = "darkred")

code_plot_style_legal_pad <- function(){
  
  new <- list(vline_color = "darkred", 
               hline_color = "blue", 
               paper_color = ggplot2::alpha("yellow", .2),
               width = 40,
               height = 25)
  
    specify_code_plot_style() |> modifyList(new)

  
}



```


```{r}
create_plot_code() |>
  code_file_to_code_df() |>
  code_df_to_code_plot(code_plot_style_college_rule())

create_plot_code() |>
  code_file_to_code_df() |>
  code_df_to_code_plot(code_plot_style_legal_pad())

"library(ggplot2)\n\nggplot(cars) +\n  aes(speed, dist) #<< + \n  geom_point()" |>
  code_file_to_code_df() |>
  code_df_to_code_plot(code_plot_style_dark_mode())

create_plot_code() |>
  code_file_to_code_df() |>
  code_df_to_code_plot(code_plot_style_typed())
```





## `ggram:::clearhistory()` lets you clear your history using code, but you can also do this in your IDE

```{r clearhistory}
clearhistory <- function(){
  
  temp <- tempfile()
  write("", file = temp)
  loadhistory(temp)
  unlink(temp)
  
}
```



## `ggram()` and friends assemble meta plots containing a plot that shows code and the output, stitched together with patchwork


### helpers

<details>

```{r helpers}
# get_code <- function(code = NULL){
#   
#   # 1. get code from history if not provided
#   if(is.null(code)){
#   
#     # 1.a Get code from history
#     temp <- tempfile()
#     savehistory(file = temp)
#   
#     # 1.b remove ggram line and collapse
#     readLines(temp)[!stringr::str_detect(readLines(temp), "ggram")] |>  
#     paste(collapse = "\n")
#     
#   }else{
#     
#     code |> paste(collapse = "\n")
#     
#     }
#   
# }

specify_code_plot <- function(code = NULL, code_style_args = list()){
  
  code_df <- code |> 
    code_file_to_code_df()
  
  complete_args <- specify_code_plot_style() |> 
     modifyList(code_style_args, keep.null = T)

  code_df_to_code_plot(code_df, complete_args)
  
}

patch_code_and_output <- function(code_plot, output_plot, widths, title, ...){
  
  print(
  patchwork::free(code_plot) + output_plot + 
  patchwork::plot_layout(widths = widths) +
  patchwork::plot_annotation(title = title, ...) & 
  theme(plot.background = element_rect(colour = "black", linewidth = .05)) 
  )
  
}

specify_textoutput_plot <- function(output){
  
  output |>
    data.frame(code = _) |>
      dplyr::mutate(row_number = dplyr::row_number()) |>
      ggplot() + 
      aes(x = 1, 
          y = row_number, 
          label = code) +
      geom_text(hjust = 0, family = "mono") + 
    stamp_notebook() + 
    stamp_punched_holes()
  
}
```

</details>


```{r}
create_plot_code() |>
  specify_code_plot()
```

### user-facing ggram and friends

```{r ggram}
#' @export
ggram <- function(title = NULL, widths = c(1,1), code = NULL, 
                  code_style_args = specify_code_plot_style(),
                   output_plot = NULL, ...){
  
  code_plot <- specify_code_plot(code, code_style_args = code_style_args)

  code_vector <- code |> code_to_vector()
  code_vector <- code %||% clipr::read_clip()  # clip not clear history, get_code(code = code) #
  output <- eval(parse(text = code_vector))
  
  output_plot <- output
  # # 
  patch_code_and_output(code_plot, output_plot, widths, title, ...)

}



```

```{r, eval = F}
library(tidyverse)

ggplot(cars) +
  aes(speed, dist) +
  geom_point() +
  geom_smooth() #<<

ggram("Here is my ggram")
```


```{r, eval = T}
"library(tidyverse)

ggplot(cars) +
  aes(speed, dist) +
  geom_point() +
  geom_smooth() #<<" |>
  ggram(code = _, "Here is my ggram")

```



```{r ggram_save}
#' @export
ggram_save <- function(..., width = 8, height = 5){
  
  ggsave(..., width = width, height = height)
  
}
```



```{r, eval = F}
ggram_save("man/figures/a_ggram.png") 
```

```{r}
knitr::include_graphics("man/figures/a_ggram.png")
```


# example with retheming...

```{r, eval = F}
#############
##### CTR-C, copy target code ###
library(tidyverse)
#
ggplot(cars) + 
  aes(speed, dist) + 
  geom_point() + 
  geom_smooth() #<<
#############
#############

my_style <- specify_code_plot_style(
  highlight_colors = c("grey", "orange") |> alpha(.25), 
  vline_color = "transparent", 
  hline_color = "grey",
  accent = NULL)

ggram("Here is my ggram", code_style_args = my_style)
```




```{r ggram_df_output}
#' @export
ggram_df_output <- function(title = NULL, widths = c(1.1,1), code = NULL, code_style_args = specify_code_plot_style(), ...){
  
  code <- code |> code_to_vector()
  code <- code %||% clipr::read_clip() # get_code(code = code) # 
  code_plot <- specify_code_plot(code, code_style_args = code_style_args)
  output <- eval(parse(text = code))
  output_plot <- gt::gt(output)
  
  patch_code_and_output(code_plot, output_plot, widths, title, ...)
    
}
```




```{r, eval = F}
ggram:::clearhistory()

cars |> 
  head()

ggram_df_output()

ggsave(filename = "man/figures/a_ggram_df.png", width = 8, height = 5)
```


```{r, eval = F}
knitr::include_graphics("man/figures/a_ggram_df.png")

c("cars |> head()") |>
  ggram_df_output(code = _)
```




```{r}
knitr::include_graphics("man/figures/a_ggram_text.png")


```

# Minimally package

```{r}
usethis::use_package("ggplot2")
usethis::use_package("patchwork")
usethis::use_package("stringr")
# usethis::use_package("styler")
usethis::use_package("dplyr")
usethis::use_package("tidyr")
# usethis::use_package("magick")


knitrExtra::chunk_names_get()
knitrExtra::chunk_to_dir(
  c("clearhistory", 
    "StatCode", 
    "specify_code_plot_style",
    "stamp_notebook", 
    "helpers",
    "ggram", 
    "ggram_df_output", 
    "code_file_to_code_df", 
    "ggram_text_output",
    "ggram_tp_output",
    "code_df_to_code_plot",
    "ggram_save",
    "create_plot_code"))
```

```{r, eval = F}
rm(list = ls())
devtools::document()
devtools::check(".")
devtools::install(pkg = ".", upgrade = "never") 
```

```{r, eval = F}
remove(list = ls())
library(ggram)
library(tidyverse)

ggram:::clearhistory()

"cars" |> 
  ggram::ggram_df_output()
```


```{r, eval = T}
'library(ggplot2) 

cars |>
  ggplot() + 
  aes(x = speed, y = dist) + 
  geom_point() + 
  geom_smooth() + 
  theme_classic( #<<
    paper = "darkseagreen",  #<<
    ink = "lightyellow" |> #<<
      alpha(.7), #<<
    accent = "orange", #<<
    base_size = 18#<< 
    )  #<<' |>
  ggram(code = _, "ggram:: Familiar with ggplot2 v4.0's new theming?", subtitle = "Now it's *so* easy to specify a dramatically different look and feel -- geom_*()s are responsive to \ntheming choices like the new 'paper', 'ink', 'accent' args (as well as old 'base_size')üöÄüìäü§Ø", caption = "made with {ggram}", widths = c(1,1))
```



```{r}
knitr::knit_exit()

```

#### even more experimental

## ggram pivottable

```{r ggram_tp_output}
ggram_tp_output <- function(title = NULL, widths = c(1.1,1), code = NULL, ...){
  
  code <- get_code(code = code) # code %||% clipr::read_clip()
  code_plot <- specify_code_plot(code)
  output <- eval(parse(text = code))
  tp_output <- output |> tidypivot::collect() 
  output_plot <- gt::gt(tp_output)
  
  patch_code_and_output(code_plot, output_plot, widths, title, ...)
    
}
```


```{r, eval = F}
ggram:::clearhistory()

library(tidypivot)
tidytitanic::passengers |>
  ggtable() |>
  set_rows(sex) |>
  set_cols(survived) |>
  set_percent() |>
  set_within(sex)


ggram_tp_output()
```

```{r ggram_text_output}
ggram_text_output <- function(title = NULL, widths = c(1.1,1), code = NULL, ...){
  
  code <- get_code(code = code)
  code_plot <- specify_code_plot(code)
  output <- eval(parse(text = code))
  output_text <- capture.output(output)
  output_plot <- specify_textoutput_plot(output_text)
  
  patch_code_and_output(code_plot, output_plot, widths, title, ...)
    
}
```

```{r, eval = F}
clearhistory()

"hello world!"
1+1
cars |> head()

ggram_text_output()

ggsave(filename = "man/figures/a_ggram_text.png", width = 8, height = 5)
```


```{r}
ggram:::clearhistory()


p0 <- ggplot(data = diamonds) +
  aes(x = cut,
      fill = clarity) +
  geom_bar() + 
  labs(title = "Each length is the proportion of the whole")
#
p0

ggram()
```

```{r}
ggram:::clearhistory()

p0 + 
  aes(y = after_stat(count) / 
       sum(after_stat(count)))

ggram()


ggram:::clearhistory()

diamonds |>
  ggplot() +
  aes(x = cut, fill = color) +
  geom_bar(position = "fill") + 
  labs(title = "Lengths show the within-cut proportions")

library(tidyverse)
set_theme()
library(ggram)

gapminder::gapminder |>
  filter(year == 2002) ->
gapminder_2002

ggram:::clearhistory()

library(ggcirclepack) #<< 
ggplot(data = gapminder_2002) +
  aes(id = country,
      area = pop,
      colour = continent) +
  geom_circlepack() + #<<
  geom_circlepack_text() + #<<
  theme(legend.position = "none") + 
  coord_equal()


ggram("#30DayChartChallenge, #Day3 - #Circular", subtitle = "With ggplot2 extension github.com/EvaMaeRey/ggcirclepack")


library(ggplot2)
```


```{r hadley}
ggplot(data = mtcars) + # 'I'd get a dataset...' 
  aes(x = wt,  # 'I want to put this on the x-axis' 
      y = mpg) + # 'Let's put this on the y-axis'
  geom_point() + # 'Put some points here'
  geom_smooth() + # 'Draw a line'
  facet_wrap(vars(cyl)) # 'Break it up by this variable'
```



```{r}
library(tidyverse)
compute_panel_comment <- function(data, scales){
  
 data |>
    tidyr::separate(code, into = c("code", "comment"), sep = "#") |>
    mutate(row = row_number()) |> 
    mutate(nchar_code = nchar(.data$code))
    
  
}

StatComment <- ggproto("StatComment", Stat,
                       compute_panel = compute_panel_comment,
                       default_aes = 
                         aes(y = after_stat(row),
                             label = after_stat(comment) |>
                                           str_wrap(15),
                             x = after_stat(ifelse(row %% 2, 0-2, 20 + 2)),
                             hjust = after_stat(ifelse(row %% 2,1.2, -.2))
                             ))


compute_panel_code_w_comment <- function(data, scales){
  
 data |>
    tidyr::separate(code, into = c("code", "comment"), sep = "#") |>
    mutate(row = row_number()) |> 
    mutate(code = str_split(.data$code, "")) |>
    unnest(code) |>
    group_by(row) |> 
    mutate(x = row_number()) |>
    mutate(is_character = .data$code != " ") |>
    mutate(is_code = cumsum(.data$is_character) |> as.logical()) |>
    filter(.data$is_code) |>
    mutate(label = .data$code)
  
}

# knitrExtra::chunk_code_get("hadley") |> 
#   data.frame(code = _) |>
#   compute_panel_code_w_comment()


StatCodeRemoveComment <- ggproto("StatCodeRemoveComment", Stat,
                       compute_panel = compute_panel_code_w_comment,
                       default_aes = aes(y = after_stat(row)))
```

```{r, fig.height=8, fig.width=8}
library(ggplyr)
knitrExtra::chunk_code_get("hadley") |> 
  data.frame(code = _) |>
  ggplot() + 
  aes(code = code) + 
  geom_text(stat = StatCodeRemoveComment,
            family = "mono",
            size = 8) + 
  geom_tile(stat = StatCodeRemoveComment,
            fill = alpha("slateblue", .1)) + 
  geom_label(stat = StatComment, 
             label.padding = unit(.2, "in"),
             label.r = unit(.2, "in"),
             size = 3.5
             ) + 
  geom_label(stat = StatComment,
             aes(label = after_stat(row))) +
  geom_text(stat = StatCodeLineNumbers,
            size = 7, alpha = .3) +
  scale_y_reverse() + 
  coord_cartesian(expand = T, 
                  xlim = c(-10, 30),
                  ylim = c(0, 20)) + 
  theme_void(ink = "slateblue",
             paper = "whitesmoke",
             base_size = 15) +
  theme(plot.margin = margin(10,10,10,10)) +
  geom_vline(xintercept = 0, alpha = .3) +
  labs(title = "ggplot2: transcriber of envisioned plots\n") +
  labs(subtitle = "'In my head I could very clearly kind of picture...'") +
  data_filter(row_number() == 0) + intercept() +
  data_refilter(row_number() == 1) + intercept() +
  data_refilter(row_number() %in% 1:2) + intercept() +
  data_refilter(row_number() %in% 1:3) + intercept() +
  data_refilter(row_number() %in% 1:4) + intercept() +
  data_refilter(row_number() %in% 1:5) + intercept() + 
  data_refilter(row_number() %in% 1:6) + intercept() + 
  annotate(geom = "label", linewidth = 0, label = 
  "'And then, like, getting that vision out of my head, 
  and into reality, [was] just really, really hard. 
  Just, like, felt harder than it should be. Like, 
  there's a lot of custom programming involved. 
           
  I just wanted to say, like, you know, this is what
  I'm thinking, this is how I'm picturing this plot. 
  Like, you're the computer 'Go and do it'....  
           
  And I'd also been reading about the Grammar of 
  Graphics by Leland Wilkinson, I got to meet 
  him a couple of times and ... I was, like, 
  this book has been, like, written for me.'" ,
            x = I(.35), y = I(.32), size = 5) + ggplyr::intercept() + 
  labs(caption = "Hadley Wickham on The Data Wranglers Podcast") + intercept() 

```


```{r gif_from_ggplots}
gif_from_ggplots <- function(plots, gif_output_path = "temp.gif"){
  
  plot_nums <- 1:length(plots) 
  plot_files <- paste("temp", plot_nums |> 
                        stringr::str_pad(pad = "0", width = 2), ".png")
  
  for(i in plot_nums){
    
    ggplot2::ggsave(plot_files[i], plot = plots[[i]])
    
  }
  
  image_list <- lapply(plot_files, magick::image_read)
  frames <- magick::image_join(image_list)
  gif <- magick::image_animate(frames, fps = 2, optimize = TRUE) # 1 frame per second
  magick::image_write(gif, path = gif_output_path)
  cat(paste("GIF saved to:", gif_output_path, "\n"))

}
```



```{r}
library(ggplyr)
ggplot(cars) + intercept() + 
  aes(speed) + intercept() + 
  geom_histogram() + intercept()

# gif_from_ggplots(list(p1, p2, p3))

```



```{r}
library(ggplot2)

cars |>
  ggplot() + 
  aes(
    x = speed,
    y = dist, 
    color = I("blue") #<<
      ) + 
  geom_point() + 
  theme_gray(base_size = 18)


ggram::ggram("ggram:: Have you used the I() 'as is' function to set aesthetics? (>= v3.5 behaivor! üëÄüö®)",
             subtitle = "Who hasn't made the occasionally 'aes(color = \"blue\")' mistake? ü§î Probably no one!\nUsing I() in the aes() call can be a quick, in-place fix! üëç")
```
  
  
```  
library(patchwork)
(p1 + p2) /
  (p3 + p4) /
  (p5 + plot_spacer())
  
ggsave("p1.pdf", p1, height=8, width=8)
ggsave("p2.pdf", p2, height=8, width=8)
ggsave("p3.pdf", p3, height=8, width=8)
ggsave("p4.pdf", p4, height=8, width=8)
ggsave("p5.pdf", p5, height=8, width=8)
ggsave("p6.pdf", p6, height=8, width=8)
ggsave("p7.pdf", p7, height=8, width=8)
ggsave("p8.pdf", p8, height=8, width=8)

pdf_list <- list.files(pattern = "p\\d", )

pdftools::pdf_combine(pdf_list, output = "slideshow.pdf")

```

